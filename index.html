<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://d3js.org/d3.v6.js"></script>
</head>
<body>
<svg id="pump_map" style="margin: 0 auto; width: 625px; height: 580px;"></svg>


<!--<script src="index.js" type="module"></script>-->
<script>
    // fr.readAsText('streets.json');
    // var reader = new FileReader().readAsText('streets.json');
    files = []
    files.push(d3.json("./streets.json"));
    files.push(d3.csv('pumps.csv'));
    files.push(d3.csv('deathdays.csv'));
    files.push(d3.csv('deaths_age_sex.csv'));

    const createMap = (streets, scale, xOffset, yOffset) => {
        const svg = d3.select('#pump_map');
        streets.forEach((seg) => {
            lines = svg.append('path')
                .attr("stroke", "black")
                .attr("stroke-width", 1)
                .attr("fill", "none")
                .datum(seg)
                .attr("d",
                    d3.line()
                        .x(function(d) { return d['x'] * scale - xOffset})
                        .y(function(d) { return d['y'] * scale - yOffset})
                );
        });
    }

    const addPumps = (pumps, scale, xOffset, yOffset) => {
        const svg = d3.select('#pump_map');
        console.log(pumps);
        pumps.forEach((cords) => {
            svg.append('circle')
                .style("fill", "purple")
                // .style("stroke-width", 5)
                .attr("cx", cords['x'] * scale - xOffset)
                .attr("cy", cords['y'] * scale - yOffset)
                .attr("r", 10)
        })
    }

    Promise.all(files).then((data) => {
        console.log(data);
        console.log('hi');
        const scale = 35;
        const yOffset = 95
        const xOffset = 95
        createMap(data[0], scale, yOffset, xOffset);
        addPumps(data[1], scale, yOffset, xOffset);
    });





</script>
<script>

</script>
</body>
</html>